<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Watchlist & Portfolio - MaFinance Pro</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico" />
    <link rel="stylesheet" href="style.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">
    <custom-navbar></custom-navbar>

    <main class="flex-grow py-8">
        <div class="container mx-auto px-6">
            <!-- Header -->
            <div class="mb-8">
                <h1 class="text-4xl font-bold text-gray-800 mb-2">My Watchlist & Portfolio</h1>
                <p class="text-gray-600">Track your favorite stocks and manage your portfolio</p>
            </div>

            <!-- Tabs -->
            <div class="mb-8">
                <div class="border-b border-gray-200">
                    <nav class="-mb-px flex space-x-8">
                        <button onclick="switchTab('watchlist')" id="watchlist-tab" class="tab-button active border-b-2 border-blue-600 py-4 px-1 text-sm font-medium text-blue-600">
                            <i data-feather="star" class="inline-block w-4 h-4 mr-2"></i>
                            Watchlist (<span id="watchlist-count">0</span>)
                        </button>
                        <button onclick="switchTab('portfolio')" id="portfolio-tab" class="tab-button border-b-2 border-transparent py-4 px-1 text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300">
                            <i data-feather="briefcase" class="inline-block w-4 h-4 mr-2"></i>
                            Portfolio (<span id="portfolio-count">0</span>)
                        </button>
                        <button onclick="switchTab('alerts')" id="alerts-tab" class="tab-button border-b-2 border-transparent py-4 px-1 text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300">
                            <i data-feather="bell" class="inline-block w-4 h-4 mr-2"></i>
                            Price Alerts (<span id="alerts-count">0</span>)
                        </button>
                    </nav>
                </div>
            </div>

            <!-- Watchlist Tab -->
            <div id="watchlist-content" class="tab-content">
                <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">My Watchlist</h2>
                        <div class="flex gap-3">
                            <button onclick="watchlistManager.clearWatchlist()" class="px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors">
                                <i data-feather="trash-2" class="inline-block w-4 h-4 mr-2"></i>
                                Clear All
                            </button>
                            <button onclick="watchlistManager.exportData()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                <i data-feather="download" class="inline-block w-4 h-4 mr-2"></i>
                                Export
                            </button>
                        </div>
                    </div>

                    <div id="watchlist-stocks" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Stocks will be loaded here -->
                    </div>

                    <div id="watchlist-empty" class="text-center py-16 hidden">
                        <i data-feather="star" class="w-16 h-16 mx-auto text-gray-300 mb-4"></i>
                        <h3 class="text-xl font-semibold text-gray-600 mb-2">Your watchlist is empty</h3>
                        <p class="text-gray-500 mb-6">Start adding stocks to track their performance</p>
                        <a href="/stocks.html" class="inline-block px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            Browse Stocks
                        </a>
                    </div>
                </div>
            </div>

            <!-- Portfolio Tab -->
            <div id="portfolio-content" class="tab-content hidden">
                <!-- Portfolio Summary -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-600">
                        <div class="text-sm text-gray-600 mb-1">Total Investment</div>
                        <div class="text-3xl font-bold text-gray-900" id="total-investment">0 MAD</div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-600">
                        <div class="text-sm text-gray-600 mb-1">Current Value</div>
                        <div class="text-3xl font-bold text-gray-900" id="current-value">0 MAD</div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-purple-600">
                        <div class="text-sm text-gray-600 mb-1">Total Profit/Loss</div>
                        <div class="text-3xl font-bold" id="total-profit">0 MAD</div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-orange-600">
                        <div class="text-sm text-gray-600 mb-1">Return %</div>
                        <div class="text-3xl font-bold" id="return-percentage">0%</div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">My Holdings</h2>
                        <button onclick="showAddPortfolioModal()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            <i data-feather="plus" class="inline-block w-4 h-4 mr-2"></i>
                            Add Holding
                        </button>
                    </div>

                    <div id="portfolio-holdings" class="overflow-x-auto">
                        <!-- Holdings table will be loaded here -->
                    </div>

                    <div id="portfolio-empty" class="text-center py-16 hidden">
                        <i data-feather="briefcase" class="w-16 h-16 mx-auto text-gray-300 mb-4"></i>
                        <h3 class="text-xl font-semibold text-gray-600 mb-2">Your portfolio is empty</h3>
                        <p class="text-gray-500 mb-6">Add your stock holdings to track performance</p>
                        <button onclick="showAddPortfolioModal()" class="inline-block px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            Add First Holding
                        </button>
                    </div>
                </div>
            </div>

            <!-- Price Alerts Tab -->
            <div id="alerts-content" class="tab-content hidden">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">Price Alerts</h2>
                        <button onclick="showAddAlertModal()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            <i data-feather="bell" class="inline-block w-4 h-4 mr-2"></i>
                            New Alert
                        </button>
                    </div>

                    <div id="alerts-list" class="space-y-4">
                        <!-- Alerts will be loaded here -->
                    </div>

                    <div id="alerts-empty" class="text-center py-16 hidden">
                        <i data-feather="bell-off" class="w-16 h-16 mx-auto text-gray-300 mb-4"></i>
                        <h3 class="text-xl font-semibold text-gray-600 mb-2">No price alerts set</h3>
                        <p class="text-gray-500 mb-6">Get notified when stocks reach your target price</p>
                        <button onclick="showAddAlertModal()" class="inline-block px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            Create First Alert
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Add Portfolio Modal -->
    <div id="add-portfolio-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white rounded-xl shadow-2xl max-w-md w-full p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-800">Add to Portfolio</h3>
                <button onclick="closeAddPortfolioModal()" class="text-gray-400 hover:text-gray-600">
                    <i data-feather="x"></i>
                </button>
            </div>

            <form id="add-portfolio-form" onsubmit="handleAddPortfolio(event)" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Stock Symbol</label>
                    <input type="text" id="portfolio-symbol" class="form-input w-full" placeholder="e.g., ATW" required />
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Stock Name</label>
                    <input type="text" id="portfolio-name" class="form-input w-full" placeholder="e.g., ATTIJARIWAFA BANK" required />
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Number of Shares</label>
                    <input type="number" id="portfolio-shares" class="form-input w-full" placeholder="10" min="0.01" step="0.01" required />
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Buy Price (MAD)</label>
                    <input type="number" id="portfolio-price" class="form-input w-full" placeholder="750.00" min="0.01" step="0.01" required />
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Purchase Date</label>
                    <input type="date" id="portfolio-date" class="form-input w-full" required />
                </div>

                <div class="flex gap-3 mt-6">
                    <button type="button" onclick="closeAddPortfolioModal()" class="flex-1 px-4 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
                        Cancel
                    </button>
                    <button type="submit" class="flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        Add to Portfolio
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Alert Modal -->
    <div id="add-alert-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white rounded-xl shadow-2xl max-w-md w-full p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-800">Set Price Alert</h3>
                <button onclick="closeAddAlertModal()" class="text-gray-400 hover:text-gray-600">
                    <i data-feather="x"></i>
                </button>
            </div>

            <form id="add-alert-form" onsubmit="handleAddAlert(event)" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Stock Symbol</label>
                    <input type="text" id="alert-symbol" class="form-input w-full" placeholder="e.g., ATW" required />
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Stock Name</label>
                    <input type="text" id="alert-name" class="form-input w-full" placeholder="e.g., ATTIJARIWAFA BANK" required />
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Target Price (MAD)</label>
                    <input type="number" id="alert-price" class="form-input w-full" placeholder="800.00" min="0.01" step="0.01" required />
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Alert Condition</label>
                    <select id="alert-condition" class="form-input w-full" required>
                        <option value="above">Price goes above target</option>
                        <option value="below">Price goes below target</option>
                    </select>
                </div>

                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <div class="flex items-start gap-3">
                        <i data-feather="info" class="text-blue-600 flex-shrink-0 mt-1"></i>
                        <div class="text-sm text-blue-800">
                            You'll receive a browser notification when the price condition is met. Make sure to allow notifications for this site.
                        </div>
                    </div>
                </div>

                <div class="flex gap-3 mt-6">
                    <button type="button" onclick="closeAddAlertModal()" class="flex-1 px-4 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
                        Cancel
                    </button>
                    <button type="submit" class="flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        Set Alert
                    </button>
                </div>
            </form>
        </div>
    </div>

    <custom-footer></custom-footer>

    <div id="notification-container" class="fixed top-4 right-4 z-[9999] space-y-2"></div>

    <script src="components/navbar.js"></script>
    <script src="components/footer.js"></script>
    <script src="watchlist-manager.js"></script>
    <script src="watchlist-page.js"></script>
    <script>
        feather.replace();

        // Set default date to today
        document.getElementById('portfolio-date').valueAsDate = new Date();
    </script>
</body>
</html>
